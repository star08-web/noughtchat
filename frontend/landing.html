<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noughtchat - Anonymous Encrypted Chat</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="grid-container">
        <div class="grid-item" style="margin-left: 20px;">
            <header>
                <h1>Noughtchat</h1>
                <p>Anonymous Encrypted Chat</p>
                <br>
                <details>
                    <summary>More Info</summary>
                    <p>
                        Noughtchat is a simple, anonymous, and encrypted chat application. Start a new chat session and share the link with your friends to chat securely. All messages are end-to-end encrypted, ensuring your privacy.
                        <br><br>
                        Features:
                        <ul>
                            <li>Anonymous chat sessions</li>
                            <li>End-to-end encryption</li>
                            <li>No account required</li>
                        </ul>
                        <br>
                        Chats expire after 1 hour of inactivity and never touch the disk, remember to export your chat if you want to keep a copy!
                    </p>
                </details>
            </header>
            <br>
            <br>
            <br>
            <br>
            <button id="newcht" class="btn">Start New Chat</button>
        </div>
        <div class="grid-item">
            <img class="computer" src="pc.png" alt="Computer Image">
        </div>
    </div>
    <br>
    <br>
    <footer>
        <p>Powered by <a href="https://github.com/star08-web/noughtchat">Noughtchat</a></p>
        <p>&copy; <span id="year"></span> Noughtchat and its contributors. No rights reserved, licensed under <a href="https://opensource.org/license/unlicense/">The Unlicense</a>.</p>
        <p>Please read our <a href="/liability">liability disclaimer</a> before using the service.</p>  
    </footer>
    <script>
        document.getElementById('newcht').addEventListener('click', newChat);
        let pkey_needed = false;
        fetch('/require_pkey')
            .then(response => response.json())
            .then(data => {
                pkey_needed = data.require_key;
            })
            .catch(error => {
                console.error('Error fetching product key requirement status:', error);
            });
        function newChat() {
            let key = "NCHAT_PKEY-000-0000";
            if (pkey_needed) {
                key = prompt("This instance of Noughtchat requires a Product Key. Please enter your Product Key:");
                if (!key) {
                    alert('Product Key is required to create a new chat.');
                    return;
                }
            }
            fetch('/create_chat', { 
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Noughtchat-Askey': key
                }
            })
                .then(response => response.json())
                .then(data => {
                    if (data.chat_id) {
                        window.location.href = `/chat/${data.chat_id}`;
                    } else {
                        const errorMessage = data.error || 'Unknown error occurred.';
                        const msg = `Error creating new chat: ${errorMessage}`;
                        alert(msg);
                        console.error(msg);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error creating new chat. Please try again.');
                });
        }

        document.getElementById('year').textContent = new Date().getFullYear();
    </script>
</body>

</html>